{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="zxx">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="LapOne" />
    <meta name="keywords" content="LapOne" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>LapOne</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;900&display=swap" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    {% comment %} <link href="../../css2-4?family=Public+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet" /> {% endcomment %}
    <!-- Css Styles -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />

    <!-- CSS -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.14.0/build/css/alertify.min.css" />
    <!-- Default theme -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.14.0/build/css/themes/default.min.css" />

    <link rel="stylesheet" href="{% static 'assets/css/nice-select.css' %}" type="text/css" />
    <link rel="stylesheet" href="{% static 'assets/css/jquery-ui.min.css' %}" type="text/css" />
    <link rel="stylesheet" href="{% static 'assets/css/owl.carousel.min.css' %}" type="text/css" />
    {% comment %}d√πng cho all departments{% endcomment %}
    <link rel="stylesheet" href="{% static 'assets/css/slicknav.min.css' %}" type="text/css" />
    <link rel="stylesheet" href="{% static 'assets/css/style.css' %}" type="text/css" />
    {% block styleChat %}{% endblock styleChat %}

  </head>

  <body>
    <!-- Header Section Begin -->
    <header class="header">
      <div class="header__top">
        <div class="container">
          <div class="row">
            <div class="col-lg-6 col-md-6">
              <div class="header__top__left mt-1" style="width: 800px;">
                <ul class="d-flex align-text-bottom">
                  <li>
                    <i class="fa fa-envelope"></i> ctsv@ptit.edu.vn
                  </li>
                  <li style="width: 500px;"><marquee>V·∫≠n chuy·ªÉn mi·ªÖn ph√≠ to√†n qu·ªëc cho m·ªçi ƒë∆°n h√†ng ‚Äì ƒê·ª´ng b·ªè l·ª°!    Nh·∫≠p m√£ <strong>GIAM10</strong>  ƒë·ªÉ nh·∫≠n ngay ∆∞u ƒë√£i gi·∫£m <strong>10%</strong> cho ƒë∆°n h√†ng b·∫•t k·ª≥!</marquee></li>
                </ul>
              </div>
            </div>
            <div class="col-lg-6 col-md-6">
              <div class="header__top__right">
                <div class="header__top__right__social">
                  <a href="#"><i class="fa-brands fa-facebook-f"></i></a>
                  <a href="#"><i class="fa-brands fa-twitter"></i></a>
                  <a href="#"><i class="fa-brands fa-linkedin-in"></i></a>
                  {% comment %} <a href="#"><i class="fa-brands fa-pinterest-p"></i></a> {% endcomment %}
                </div>
                {% comment %} <div class="header__top__right__language">
                  <img src="{% static 'assets/img/language.png' %}" alt="" />
                  <div>English</div>
                  <span class="arrow_carrot-down"></span>
                  <ul>
                    <li>
                      <a href="#">Spanis</a>
                    </li>
                    <li>
                      <a href="#">English</a>
                    </li>
                  </ul>
                </div> {% endcomment %}
                {% if request.user.is_authenticated %}
                  {% comment %} <div class="menu-container">
                    <h5 class="d-inline-block">Xin ch√†o <strong>{{ username }}</strong></h5>
                    <div class="menu menu-username">
                      <ul>
                        <li>
                          <a href="{% url 'dashboard:index' %}">T√†i kho·∫£n</a>
                        </li>
                        <li>
                          <a href="#option2">Option 2</a>
                        </li>
                        <li>
                          <a href="#option3">Option 3</a>
                        </li>
                      </ul>
                    </div>
                  </div> {% endcomment %}
                  <div class="menu-container dropdown-center">
                    <button class="btn btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">Xin ch√†o <strong>{{ request.user.profile.full_name }}</strong></button>
                    <ul class="dropdown-menu">
                      <li>
                        <a class="dropdown-item" href="{% url 'dashboard:index' %}">T√†i kho·∫£n</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="{% url 'dashboard:order' %}">ƒê∆°n h√†ng</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="{% url 'userauths:change-password' %}">ƒê·ªïi m·∫≠t kh·∫©u</a>
                      </li>
                      <li>
                        <hr class="dropdown-divider" />
                      </li>
                      <li>
                        <a class="dropdown-item" href="{% url 'userauths:sign-out' %}"><i class="fa-solid fa-right-from-bracket"></i> Logout</a>
                      </li>
                    </ul>
                  </div>
                  <div class="header__top__right__auth ms-2"></div>
                {% else %}
                  <div class="header__top__right__auth">
                    <a href="{% url 'userauths:sign-in' %}"><i class="fa fa-user"></i> ƒêƒÉng nh·∫≠p</a>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="container">
        <div class="row">
          <div class="col-lg-3">
            <div class="header__logo">
              <a href="{% url 'core:index' %}"><img src="{% static 'assets/img/logo2.png' %}" alt="" /></a>
            </div>
          </div>
          <div class="col-lg-6 text-center">
            <nav class="header__menu">
              <ul>
                <li class="active">
                  <a class="text-success" href="{% url 'core:index' %}">Home</a>
                </li>
                <li>
                  <a href="{% url 'core:product-list' %}">Shop</a>
                  {% comment %} <ul class="header__menu__dropdown">
                    {% for c in categories %}
                      <li>
                        <a href="{% url 'core:category-product-list' c.cid %} ">{{ c.title }}</a>
                      </li>
                    {% endfor %}
                  </ul> {% endcomment %}
                </li>
                {% comment %} <li>
                  <a href="#">Pages</a>
                  <ul class="header__menu__dropdown">
                    <li>
                      <a href="./shop-details.html">Shop Details</a>
                    </li>
                    <li>
                      <a href="./shoping-cart.html">Shoping Cart</a>
                    </li>
                    <li>
                      <a href="./checkout.html">Check Out</a>
                    </li>
                    <li>
                      <a href="./blog-details.html">Blog Details</a>
                    </li>
                    <li>
                      <a href="{% url 'core:vendor-list' %}">Vendor List</a>
                    </li>
                  </ul>
                </li>
                <li>
                  <a href="./blog.html">Blog</a>
                </li> {% endcomment %}

                <li>
                  <a href="{% url 'core:contact' %}">Contact</a>
                </li>
                <li>
                  <a href="http://127.0.0.1:8000/chat/testchat">Chat</a>
                </li>
                <li>
                  <a href="{% url 'dashboard:index' %}">Dashboard</a>
                </li>
              </ul>
            </nav>
          </div>
          <div class="col-lg-3">
            <div class="header__cart">
              <ul>
                <li>
                  <a href="{% url 'core:wishlist' %}"><i class="fa fa-heart"></i> <span>{{ wishlist.count|default:0 }}</span></a>
                </li>
                <li>
                  <a href="{% url 'core:cart' %}"><i class="fa fa-shopping-bag"></i> <span class="cart-items-count">{{ request.session.cart_data_obj|length }}</span></a>
                </li>
              </ul>
              <div class="header__cart__price">
                Gi·ªè h√†ng: <span id="total-amount">0</span>ƒë
              </div>
            </div>
          </div>
        </div>
        <div class="humberger__open">
          <i class="fa fa-bars"></i>
        </div>
      </div>
    </header>
    <!-- Header Section End -->

    <section class="hero">
      <div class="container">
        <div class="row">
          <div class="col-lg-3">
            <div class="hero__categories">
              <div class="hero__categories__all bg-success">
                <i class="fa fa-bars"></i>
                <span class="" style="font-family: 'Poppins', sans-serif;">Th∆∞∆°ng hi·ªáu<i class="fas fa-chevron-down"></i></span>
              </div>
              <ul style="box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);">
                {% for c in categories %}
                  <li class="categories__item--li">
                    <a href="{% url 'core:category-product-list' c.cid %}">
                      {{ c.title }}
                      <span class="categories__item--quantity">{{ c.category.count }}</span>
                    </a>
                  </li>
                {% endfor %}
              </ul>
            </div>
          </div>
          <div class="col-lg-9">
            <div class="hero__search">
              <div class="hero__search__form">
                <form action="{% url 'core:search' %}" method="GET">
                  <input type="text" name="q" placeholder="T√¨m ki·∫øm t·∫°i LapOne" />
                  <button type="submit" class="site-btn bg-success">SEARCH</button>
                </form>
              </div>
              <div class="hero__search__phone">
                <div class="hero__search__phone__icon">
                  <i class="fa fa-phone"></i>
                </div>
                <div class="hero__search__phone__text">
                  <h5>024 3756 2186</h5>
                  <span>support 24/7 time</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% block index %}

        {% endblock %}
      </div>
    </section>

    {% block content %}

    {% endblock %}
    
    <div class="chat-popup" id="chatBox">
      <div class="chat-header">
          <h2>Chat chung</h2>
          <button class="close-btn" onclick="toggleChatBox()">√ó</button>
      </div>
      <hr>
      <div class="chat-body-parent">
          <div class="chat-body" id="tasks">
              <div class="message" id="chatContainer">
                  <!-- received messages and displayed here -->
                  {% for i in ms %}
                    {% if i.sender != username %}
                        <div class="receive">
            
                            <p class="message-text">{{ i.message }}</p>
                            <p class="sender-name">{{ i.sender }} - {{ i.date|date:"H:i" }}</p>
                        </div>
                    {% else %}
                        <div class="send">
                            <p class="message-text">{{ i.message }}</p>
                            <p class="sender-name">{{ i.sender }} - {{ i.date|date:"H:i" }}</p>
                        </div>
                    {% endif %}
                  {% endfor %}
                  <!-- end receive messages -->
              </div>
  
              <div class="form">
                  <form action="" id="message-form" method="POST">
                      {% csrf_token %}
                      <textarea id="msg" cols="30" name="message" rows="10" placeholder="Nh·∫≠p tin nh·∫Øn..." required></textarea>
                      <button class="submit" type="submit">Send</button>
                  </form>    
              </div>
          </div>
      </div>
  </div>
  <button class="chat-icon" id="chatIcon" onclick="toggleChatBox()">üí¨</button>
  


    <!-- Footer Section Begin -->
    <footer class="footer spad">
      <div class="container">
        <div class="row d-flex flex-row justify-content-between">
          <div class="col-lg-3 col-md-6 col-sm-6">
            <div class="footer__about">
              <div class="footer__about__logo">
                <a href="{% url 'core:index' %}"><img style="mix-blend-mode: multiply;" src="{% static 'assets/img/logo2.png' %}" alt="" /></a>
              </div>
              <!--                                                                              
              <ul>
                <li>Address: 60-49 Road 11378 New York</li>
                <li>Phone: +65 11.188.888</li>
                <li>Email: hello@colorlib.com</li>
              </ul>
                                                                                            -->
            </div>
          </div>
          <div class="col-lg-7 col-md-12">
            <div class="footer__widget">
              <ul style="width: 100%;;">
                <li class="m-2">
                  <strong>S·ªë ƒëi·ªán tho·∫°i li√™n h·ªá:</strong> 024 3756 2186
                </li>
                <li class="m-2">
                  <strong>Email:</strong> ctsv@ptit.edu.vn
                </li>
                <li class="m-2">
                  <strong>Tr·ª• s·ªü ch√≠nh:</strong> Km10, ƒê∆∞·ªùng Nguy·ªÖn Tr√£i, Q. H√† ƒê√¥ng, H√† N·ªôi
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-12">
            <div class="footer__copyright">
              <div class="footer__copyright__text">
                <p></p>
              </div>
              <div class="footer__copyright__payment">
                <img src="{% static 'assets/img/payment-item.png' %}" alt="" />
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
    <!-- Footer Section End -->

    <!-- Js Plugins -->

    {% comment %}thanh to√°n{% endcomment %}

    {% comment %}END thanh to√°n{% endcomment %}
    <script>
      
      function getCurrentTime() {
        const now = new Date(); // Get the current date and time
        const hours = String(now.getHours()).padStart(2, '0'); // Get the hours, ensuring two digits
        const minutes = String(now.getMinutes()).padStart(2, '0'); // Get the minutes, ensuring two digits
        return `${hours}:${minutes}`; // Return the formatted time (HH:mm)
    }

      const chatBody = document.getElementsByClassName("message")[0];
      
      function scrollToBottom() {
        chatBody.scrollTop = chatBody.scrollHeight; 
      }
      window.onload = scrollToBottom();
      const websocketProtocol = window.location.protocol === "https:" ? "wss" : "ws";
      const wsEndpoint = `${websocketProtocol}://${window.location.host}/ws/notification/{{room_name}}/`;
      const socket = new WebSocket(wsEndpoint);
  
      document.getElementById('message-form').addEventListener('submit', function(event){
          event.preventDefault();
          const message = document.getElementById('msg').value;
          socket.send(
              JSON.stringify({
                  'message': message,
                  'room_name': '{{room_name}}',
                  'sender': '{{user}}',
              })
          )
      });
  
      // response from consumer on server
      socket.addEventListener("message", (event) => {
          const messageData = JSON.parse(event.data)['message'];
          console.log(messageData);
          
          var sender = messageData['sender'];
          var message = messageData['message'];
  
          // empty message input field after message has been sent
          if (sender){
              document.getElementById('msg').value = '';
          }
          const currentTime = getCurrentTime();
          // Here's where we append the message to the chatbox.
          var messageDiv = document.querySelector('.message');
          if (sender != '{{ user }}') {
            messageDiv.innerHTML += `
                <div class="receive">
                    <p class="message-text">${message}</p>
                    <p class="sender-name">${sender} - ${currentTime}</p>
                </div>
            `;
        } else {
            messageDiv.innerHTML += `
                <div class="send">
                    <p class="message-text">${message}</p>
                    <p class="sender-name">${sender} - ${currentTime}</p>
                </div>
            `;
        }
          scrollToBottom();
  
      });
  
      socket.onopen = (event) => {
          console.log("WebSocket connection opened!");
      };
  
      socket.onclose = (event) => {
          console.log("WebSocket connection closed!");
      };
  
  </script>
    <script>

      {% comment %} function toggleChat() {
        const chatBox = document.getElementById("chatBox");
        if (chatBox.style.display === "none" || chatBox.style.display === "") {
            chatBox.style.display = "flex";
        } else {
            chatBox.style.display = "none";
        }
    } {% endcomment %}

    function toggleChatBox() {
      var chatBox = document.getElementById("chatBox");
      var chatIcon = document.getElementById("chatIcon");
      if (chatBox.style.display === "none") {
        chatBox.style.display = "block";
        chatIcon.style.display = "none"; // Hide the icon when the chat box is visible
    } else {
        chatBox.style.display = "none";
        chatIcon.style.display = "block"; // Show the icon again when the chat box is hidden
    }
      scrollToBottom();
  }
  
  // Make sure to initially hide the chatBox
  window.onload = function() {
      document.getElementById("chatBox").style.display = "none";
  };
  
    </script>
    <script src="{% static 'assets/js/jquery-3.3.1.min.js' %}"></script>
    {% comment %} <script src="{% static 'assets/js/bootstrap.min.js' %}"></script> {% endcomment %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="{% static 'assets/js/jquery.nice-select.min.js' %}"></script>
    <script src="{% static 'assets/js/jquery-ui.min.js' %}"></script>
    <script src="{% static 'assets/js/jquery.slicknav.js' %}"></script>
    <script src="{% static 'assets/js/mixitup.min.js' %}"></script>
    <script src="{% static 'assets/js/owl.carousel.min.js' %}"></script>
    <script src="{% static 'assets/js/main.js' %}"></script>
    {# flash message #}
    <script src="//cdn.jsdelivr.net/npm/alertifyjs@1.14.0/build/alertify.min.js"></script>
    {% block showNo %}
    {% endblock %}
    <script>
        {% for message in messages %}  

            {% if 'success' in message.tags %}
              showNotification("s","{{ message }}")
            {% elif 'warning' in message.tags %}
              showNotification("w","{{ message }}")
            {% elif 'error' in message.tags %}
            showNotification("e","{{ message }}")
            {% else %}
              showNotification("","{{ message }}")
            {% endif %}
        {% endfor %}
    </script>

    
  </body>
</html>

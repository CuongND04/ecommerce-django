{% extends 'partials/base.html' %}
{% load static %}
{% block content %}
  <!-- Breadcrumb Section Begin -->
  <section class="breadcrumb-section set-bg" data-setbg="{% static 'assets/img/breadcrumb.jpg' %}">
    <div class="container">
      <div class="row">
        <div class="col-lg-12 text-center">
          <div class="breadcrumb__text">
            <h2>Checkout</h2>
            <div class="breadcrumb__option">
              <a href="./index.html">Home</a>
              <span>Checkout</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- Breadcrumb Section End -->

  <!-- Checkout Section Begin -->
  <section class="checkout spad">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          {% comment %} <h6><span class="icon_tag_alt"></span> Have a coupon? <a href="#">Click here</a> to enter your code</h6> {% endcomment %}
        </div>
      </div>
      <button type="submit" class="site-btn mb-4"><i class="fa-solid fa-angles-left"></i><a class="text-white ms-2" href="{% url 'core:cart' %}">Back to cart</a></button>
      <div class="checkout__form">
        <h4>Billing Details</h4>
        <form method="post">
          <div class="row">
            <div class="col-lg-8 col-md-6">
              <div class="row">
                {% for o in order_items %}
                  <div class="col-lg-6 mb-2">
                    <div class="card" style="max-width: 540px;border: 5px solid #f5f5f5;border-radius: 0px;box-shadow: 0px  0 0 15px rgba(0, 0, 0, 0);">
                      <div class="row g-0">
                        <div class="col-sm-4">
                          <img src="{{ o.image }}" style="height: 100%;width: 100%;  object-fit: cover;" class="rounded-start" alt="Card image" />
                        </div>
                        <div class="col-sm-8">
                          <div class="card-body">
                            <h5 class="card-title">{{ o.item }}</h5>
                            <p class="card-text fs-sm">Qty: {{ o.qty }}</p>
                            <p class="card-text fs-sm">Price: ${{ o.price }}</p>
                            <p class="card-text fs-sm">Total: ${{ o.total }}</p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                {% endfor %}
              </div>
            </div>

            <div class="col-lg-4 col-md-6">
              <div class="checkout__order">
                <h4>Your Order</h4>

                {% comment %} <div class="checkout__order__totalitem">
                  Total Items <span>{{ totalcartitems }}</span>
                </div> {% endcomment %}
                {% comment %} <div class="checkout__order__products">
                  Items <span>Total</span>
                </div> {% endcomment %}
                <form class="coupon-form">
                  {% csrf_token %}
                  <div class="input-group mb-3">
                    <input name="code" type="text" class="form-control" placeholder="Coupon" aria-label="Recipient's username" />
                    <button class="btn btn-outline-success" type="submit" id="button-addon2">Apply</button>
                  </div>
                </form>

                <div class="checkout__order__subtotal">
                  Tổng tiền hàng <span>${{ old_price|floatformat:2 }}</span>
                </div>
                <div class="checkout__order__subtotal">
                  Giảm giá <span>${{ order.saved }}</span>
                </div>

                <div class="checkout__order__total">
                  Thành tiền <span>${{ order.price|floatformat:2 }}</span>
                </div>

                <div class="checkout__input__checkbox">
                  <label for="acc-or">
                    Create an account?<input type="checkbox" id="acc-or" />
                    <span class="checkmark"></span>
                  </label>
                </div>
                <p>Lorem ipsum dolor sit amet, consectetur adip elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                <div class="checkout__input__checkbox">
                  <label for="payment">
                    Check Payment<input type="checkbox" id="payment" />
                    <span class="checkmark"></span>
                  </label>
                </div>
                <div class="checkout__input__checkbox">
                  <label for="paypal">
                    Paypal<input type="checkbox" id="paypal" />
                    <span class="checkmark"></span>
                  </label>
                </div>
                <button type="button" class="btn w-100" id="checkout-button" style="background-color: green;color: white;">Pay With Stripe</button>
                <div id="paypal-button-container" class="mt-2"></div>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </section>
  <!-- Checkout Section End -->
  <script src="https://www.paypal.com/sdk/js?client-id=test&currency=USD" data-namespace="paypal_sdk"></script>

  <script>
    paypal_sdk
      .Buttons({
        createOrder: function (data, actions) {
          return actions.order.create({
            purchase_units: [
              {
                amount: {
                  value: '{{order.price}}'
                }
              }
            ]
          })
        },
    
        onApprove: function (data, actions) {
          return actions.order.capture().then(function (Detail) {
            console.log(Detail)
            if (Detail.status === 'COMPLETED') {
              window.location.href = `/payment-completed/{{ order.oid }}/?status=${Detail.status}`
            }
          })
        }
      })
      .render('#paypal-button-container')
  </script>
{% endblock %}
